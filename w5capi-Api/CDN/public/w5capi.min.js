/*w5capi encrypted single file using in browser side*/
(function(){function z(c,d,h){function g(a){function b(c,d){a.success(c,d,k);currentUserMediaRequest.streams[k]=c;currentUserMediaRequest.mutex=!1;currentUserMediaRequest.queueRequests.length&&g(currentUserMediaRequest.queueRequests.shift())}console.log(a);if(w(a.constraints))throw"You MUST set mediaType.";if(!0===currentUserMediaRequest.mutex)currentUserMediaRequest.queueRequests.push(a);else{currentUserMediaRequest.mutex=!0;var c=a.mediaConstraints||{},d=navigator,e=a.constraints||{audio:!0,video:A};
1==e.video&&(e.video=A);"undefined"!=typeof c.audio&&(e.audio=c.audio);var f=a.media;if(t){var f={minWidth:f.minWidth,minHeight:f.minHeight,maxWidth:f.maxWidth,maxHeight:f.maxHeight,minAspectRatio:f.minAspectRatio,minFrameRate:f.minFrameRate},h="1920:1080 1280:720 960:720 640:360 640:480 320:240 320:180".split(" ");-1!=h.indexOf(f.minWidth+":"+f.minHeight)&&-1!=h.indexOf(f.maxWidth+":"+f.maxHeight)||x('The min/max width/height constraints you passed "seems" NOT supported.',n(f));(f.minWidth>f.maxWidth||
f.minHeight>f.maxHeight)&&x("Minimum value must not exceed maximum value.",n(f));1280<=f.minWidth&&720<=f.minHeight&&B("Enjoy HD video! min/"+f.minWidth+":"+f.minHeight+", max/"+f.maxWidth+":"+f.maxHeight);e.video&&(e.video.mandatory=u(e.video.mandatory,f))}c.mandatory&&e.video&&(e.video.mandatory=u(e.video.mandatory,c.mandatory));c.optional&&e.video&&(e.video.optional[0]=u({},c.optional));l("media hints:",n(e));var k=JSON.stringify(e);currentUserMediaRequest.streams[k]?b(currentUserMediaRequest.streams[k],
!0):(d.getMedia=d.webkitGetUserMedia||d.mozGetUserMedia,d.getMedia(e,b,a.error||function(a){x(n(a))}))}}var e={peer:null,events:{},on:function(a,b){e.events[a]=b},emit:function(a,b,c,d,f){e.events[a](b,c,d,f)}},b=new F(c),k=new G(c);e.on("datachannel-message",function(a){a=JSON.parse(a);"text"==a.type&&k.receive(a);"undefined"!=typeof a.maxChunks&&b.receive(a);a.type||a.maxChunks||c.emit("datachannel-message",a)});e.datachannel=c.datachannel;e.candidates={};e.on("candidate",function(a){l("on-candidate is fired");
if(e.peer){if(e.peer.addIceCandidate(a),l("adding ice candidate",a.candidate),e.candidates[d]){for(a=0;a<e.candidates[d].length;a++)l("adding ice candidate",e.candidates[d][a].candidate),e.peer.addIceCandidate(e.candidates[d][a]);e.candidates[d]=[]}}else e.candidates[d]||(e.candidates[d]=[]),e.candidates[d].push(a)});var f={create:function(a,b){this.options=b;this.type=a;this.init();this.attachMediaStreams();this.options.datachannel&&w(c.mediaType)&&v&&(this.options.datachannel&&"offer"==a&&this.createDataChannel(),
this.getLocalDescription(a),this.options.datachannel&&"answer"==a&&this.createDataChannel());!w(c.mediaType)&&v&&(this.options.datachannel&&"offer"==a&&this.createDataChannel(),this.getLocalDescription(a),this.options.datachannel&&"answer"==a&&this.createDataChannel());t&&this.getLocalDescription(a);return this},getLocalDescription:function(a){l("peer type is",a);"answer"==a&&this.setRemoteDescription(e.offerDescription);var b=this;this.connection["offer"==a?"createOffer":"createAnswer"](function(a){a.sdp=
b.serializeSdp(a.sdp);b.connection.setLocalDescription(a,function(){},function(a){console.error(a)});b.options.onSessionDescription(a)},this.onSdpError,this.constraints)},serializeSdp:function(a){return a=this.setBandwidth(a)},init:function(){this.setConstraints();this.connection=new H(this.iceServers,this.optionalArgument);this.options.datachannel&&t&&this.createDataChannel();this.connection.onicecandidate=function(b){if(!a.renegotiate&&b.candidate)e.onicecandidate(b.candidate)};this.connection.onaddstream=
function(b){b.stream.userid=a.options.targetUser;l("onaddstream",b.stream);c.emit("remote-stream-private",b.stream)};this.connection.onremovestream=function(){B("media stream is removed")};this.connection.onsignalingstatechange=function(){a.connection&&l(n({iceConnectionState:a.connection.iceConnectionState,iceGatheringState:a.connection.iceGatheringState,signalingState:a.connection.signalingState}))};this.connection.oniceconnectionstatechange=function(){a.connection&&l(n({iceConnectionState:a.connection.iceConnectionState,
iceGatheringState:a.connection.iceGatheringState,signalingState:a.connection.signalingState}))};var a=this},setBandwidth:function(a){return a},setConstraints:function(){this.constraints={optional:[{googIPv6:!0},{googImprovedWifiBwe:!0},{googDscp:!0},{googScreencastMinBitrate:400}],mandatory:{OfferToReceiveAudio:!!c.mediaType.audio,OfferToReceiveVideo:!!c.mediaType.video||!!c.mediaType.screen}};l("sdp-constraints",n(this.constraints.mandatory));this.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0}]};
l("optional-argument",n(this.optionalArgument.optional));var a=[];if(v)for(var b in c.userip.userp)a.push(c.userip.userp[b]);if(t)for(b in c.userip.userp)a.push(c.userip.userp[b]);if(t&&28>C)for(b in c.userip.userold)a.push(c.userip.userold[b]);if(t&&28<=C)for(b in c.userip.usernew)a.push(c.userip.usernew[b]);this.iceServers={iceServers:a};l("ice-servers",n(this.iceServers.iceServers))},onSdpError:function(a){(a=n(a))&&-1!=a.indexOf("RTP/SAVPF Expects at least 4 fields")&&(a="It seems that you are trying to interop RTP-datachannels with SCTP. It is not supported!");
x("onSdpError:",a)},onMediaError:function(a){x(n(a))},setRemoteDescription:function(a){if(!a)throw"Remote session description should NOT be NULL.";l("setting remote description",a);this.connection.setRemoteDescription(new I(a),function(){},function(a){console.error(a)})},addIceCandidate:function(a){this.connection.addIceCandidate(new J({sdpMLineIndex:a.sdpMLineIndex,candidate:a.candidate}),function(){},function(a){console.error(a)})},createDataChannel:function(a){this.channels||(this.channels=[]);
var b={maxRetransmits:0,stream:32};if("answer"==this.type||v)this.connection.ondatachannel=function(a){c.setChannelEvents(a.channel)};(t&&"offer"==this.type||v)&&this.setChannelEvents(this.connection.createDataChannel(a||"channel",b));var c=this},setChannelEvents:function(a){var b=this;a.onmessage=function(a){b.options.emit("datachannel-message",a.data)};a.onopen=function(){c.channels[b.options.targetUser]=a;c.emit("datachannel-open",a)};a.onerror=function(a){c.emit("datachannel-error",a)};a.onclose=
function(a){c.emit("datachannel-close",a)};this.channels.push(a)},attachMediaStreams:function(){for(var a=c.mediaStreams,b=0;b<a.length;b++)l("attaching",n(a[b])),this.connection.addStream(a[b])}};e.getLocalStream=function(a){function b(a,d){l("constraints",n(a));g({constraints:a,media:c.resolutions,success:function(a,b){window.localStream=a;a.userid=c.userid;c.mediaStreams.push(window.localStream);console.log("getting media stream");console.log(b);console.log(currentUserMediaRequest);b||(c.emit("local-stream-private",
a),console.log("return back"));d&&d()}})}var d={audio:!1,video:{mandatory:{chromeMediaSource:"screen"},optional:[]}};c.mediaType.screen?c.mediaType.audio||c.mediaType.video?b(d,function(){b(c.mediaType,a)}):(window.postMessage({task:"desktop-share"},"*"),window.waiting=window.setTimeout(function(){sessionStorage.w5rtc_capiext||c.emit("extention-notAvailabel","W5RTC")},1E3)):b(c.mediaType,a);c.on("extention-notAvailabel",function(a){});window.addEventListener("message",function(c){console.error(event);
if(c.origin==window.location.origin&&(c=c.data,"finished"==c.task)){window.clearTimeout(window.waiting);var d={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height},optional:[]}};d.video.mandatory.chromeMediaSourceId=c.streamId;b(d,a)}})};e.createOffer=function(){return u({sendTo:function(a){e.peer=f.create("offer",u(e,{targetUser:a,bandwidth:c.bandwidth,onSessionDescription:function(b){c.signal({to:a,sdp:b,peerid:d})}}))}},e)};e.setRemoteDescription=
function(a){e.peer?e.peer.setRemoteDescription(a):e.offerDescription=a;return e};e.createAnswer=function(){return u({sendTo:function(a){e.peer=f.create("answer",u(e,{targetUser:a,bandwidth:c.bandwidth,onSessionDescription:function(b){c.signal({to:a,sdp:b,peerid:d})}}))}},e)};e.onicecandidate=function(a){if(c.AllowedCandidates.Host||-1==a.candidate.indexOf("typ host"))if(c.AllowedCandidates.TURN||-1==a.candidate.indexOf("typ relay"))if(c.AllowedCandidates.STUN||-1==a.candidate.indexOf("typ srflx"))c.signal({peerid:d,
to:sessionStorage.targetUser,candidate:{sdpMLineIndex:a.sdpMLineIndex,candidate:a.candidate,peerid:d}}),console.log("OnIce Candiadet"),console.log(sessionStorage.targetUser)};return e}function n(c){return JSON.stringify(c,function(c,h){return h&&h.sdp?(l(h.sdp.type,"\t",h.sdp.sdp),""):h},"\t")}function u(c,d){for(var h in d)c[h]=d[h];return c}function l(){console.log(Array.prototype.slice.call(arguments).join("\n"))}function x(){console.error(Array.prototype.slice.call(arguments).join("\n"))}function B(){console.warn(Array.prototype.slice.call(arguments).join("\n"))}
function y(){return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function w(c){var d=0,h;for(h in c)d++;return 0==d}function K(c,d){function h(){k.style.marginLeft=b.clientWidth-k.clientWidth-2+"px";l?(l.style.width=b.clientWidth/3+"px",m.style.marginLeft=b.clientWidth/3-30+"px",q&&(q.style["border-top-right-radius"]="5px")):m.style.marginLeft=b.clientWidth-m.clientWidth-2+"px";m.style.marginTop=b.clientHeight-m.clientHeight-2+"px";10>t?(t++,setTimeout(h,1E3)):t=0}d=d||{};if(!c.nodeName||
"audio"!=c.nodeName.toLowerCase()&&"video"!=c.nodeName.toLowerCase()){if(!c.getVideoTracks().length)return D(c,d);var g=c;c=document.createElement(g.getVideoTracks().length?"video":"audio");c[navigator.mozGetUserMedia?"mozSrcObject":"src"]=navigator.mozGetUserMedia?g:window.webkitURL.createObjectURL(g)}if(c.nodeName&&"audio"==c.nodeName.toLowerCase())return D(c,d);c.controls=!1;var e=d.buttons||["mute-audio","mute-video","full-screen","volume-slider","stop"];e.has=function(a){return-1!==e.indexOf(a)};
d.toggle=d.toggle||[];d.toggle.has=function(a){return-1!==d.toggle.indexOf(a)};var b=document.createElement("div");b.className="media-container";var k=document.createElement("div");k.className="media-controls";b.appendChild(k);if(e.has("mute-audio")){var f=document.createElement("div");f.className="control "+(d.toggle.has("mute-audio")?"unmute-audio selected":"mute-audio");k.appendChild(f);f.onclick=function(){if(-1!=f.className.indexOf("unmute-audio")){if(f.className=f.className.replace("unmute-audio selected",
"mute-audio"),c.muted=!1,c.volume=1,d.onUnMuted)d.onUnMuted("audio")}else if(f.className=f.className.replace("mute-audio","unmute-audio selected"),c.muted=!0,c.volume=0,d.onMuted)d.onMuted("audio")}}if(e.has("mute-video")){var a=document.createElement("div");a.className="control "+(d.toggle.has("mute-video")?"unmute-video selected":"mute-video");k.appendChild(a);a.onclick=function(){if(-1!=a.className.indexOf("unmute-video")){if(a.className=a.className.replace("unmute-video selected","mute-video"),
c.muted=!1,c.volume=1,c.play(),d.onUnMuted)d.onUnMuted("video")}else if(a.className=a.className.replace("mute-video","unmute-video selected"),c.muted=!0,c.volume=0,c.pause(),d.onMuted)d.onMuted("video")}}e.has("take-snapshot")&&(g=document.createElement("div"),g.className="control take-snapshot",k.appendChild(g),g.onclick=function(){if(d.onTakeSnapshot)d.onTakeSnapshot()});if(e.has("stop")){var r=document.createElement("div");r.className="control stop";k.appendChild(r);r.onclick=function(){b.style.opacity=
0;setTimeout(function(){b.parentNode&&b.parentNode.removeChild(b)},800);if(d.onStopped)d.onStopped()}}var m=document.createElement("div");m.className="volume-control";if(e.has("record-audio")){var p=document.createElement("div");p.className="control "+(d.toggle.has("record-audio")?"stop-recording-audio selected":"record-audio");m.appendChild(p);p.onclick=function(){if(-1!=p.className.indexOf("stop-recording-audio")){if(p.className=p.className.replace("stop-recording-audio selected","record-audio"),
d.onRecordingStopped)d.onRecordingStopped("audio")}else if(p.className=p.className.replace("record-audio","stop-recording-audio selected"),d.onRecordingStarted)d.onRecordingStarted("audio")}}if(e.has("record-video")){var s=document.createElement("div");s.className="control "+(d.toggle.has("record-video")?"stop-recording-video selected":"record-video");m.appendChild(s);s.onclick=function(){if(-1!=s.className.indexOf("stop-recording-video")){if(s.className=s.className.replace("stop-recording-video selected",
"record-video"),d.onRecordingStopped)d.onRecordingStopped("video")}else if(s.className=s.className.replace("record-video","stop-recording-video selected"),d.onRecordingStarted)d.onRecordingStarted("video")}}if(e.has("volume-slider")){g=document.createElement("div");g.className="control volume-slider";m.appendChild(g);var l=document.createElement("input");l.type="range";l.min=0;l.max=100;l.value=100;l.onchange=function(){c.volume="."+l.value.toString().substr(0,1)};g.appendChild(l)}if(e.has("full-screen")){var g=
function(a){if(a.srcElement==b){a=document.webkitIsFullScreen||document.mozFullScreen||document.fullscreen;b.style.width=(a?window.innerWidth-20:d.width)+"px";b.style.display=a?"block":"inline-block";d.height&&(n.style.height=(a?window.innerHeight-20:d.height)+"px");if(!a&&d.onZoomout)d.onZoomout();if(a&&d.onZoomin)d.onZoomin();if(!a&&-1!=q.className.indexOf("zoom-out")&&(q.className=q.className.replace("zoom-out selected","zoom-in"),d.onZoomout))d.onZoomout();setTimeout(h,1E3)}},q=document.createElement("div");
q.className="control "+(d.toggle.has("zoom-in")?"zoom-out selected":"zoom-in");l||p||s||!q?m.appendChild(q):k.insertBefore(q,k.firstChild);q.onclick=function(){if(-1!=q.className.indexOf("zoom-out"))q.className=q.className.replace("zoom-out selected","zoom-in"),document.fullscreen&&document.cancelFullScreen(),document.mozFullScreen&&document.mozCancelFullScreen(),document.webkitIsFullScreen&&document.webkitCancelFullScreen();else{q.className=q.className.replace("zoom-in","zoom-out selected");var a=
b;a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}};document.addEventListener("fullscreenchange",g,!1);document.addEventListener("mozfullscreenchange",g,!1);document.addEventListener("webkitfullscreenchange",g,!1)}(e.has("volume-slider")||e.has("full-screen")||e.has("record-audio")||e.has("record-video"))&&b.appendChild(m);var n=document.createElement("div");n.className="media-box";
b.appendChild(n);n.appendChild(c);d.width||(d.width=innerWidth/2-50);b.style.width=d.width+"px";d.height&&(n.style.height=d.height+"px");n.querySelector("video").style.maxHeight=innerHeight+"px";var t=0;d.showOnMouseEnter||"undefined"===typeof d.showOnMouseEnter?(b.onmouseenter=b.onmousedown=function(){h();k.style.opacity=1;m.style.opacity=1},b.onmouseleave=function(){k.style.opacity=0;m.style.opacity=0}):setTimeout(function(){h();setTimeout(function(){k.style.opacity=1;m.style.opacity=1},300)},700);
h();b.toggle=function(c){if("string"!=typeof c)for(var d=0;d<c.length;d++)b.toggle(c[d]);else{if("mute-audio"==c&&f)f.onclick();if("mute-video"==c&&a)a.onclick();if("record-audio"==c&&p)p.onclick();if("record-video"==c&&s)s.onclick();if("stop"==c&&r)r.onclick();return this}};b.media=c;return b}function D(c,d){function h(){b.style.marginLeft=e.clientWidth-b.clientWidth-7+"px";b.style.marginTop=e.clientHeight-b.clientHeight-6+"px";10>p?(p++,setTimeout(h,1E3)):p=0}d=d||{};if(!c.nodeName||"audio"!=c.nodeName.toLowerCase()&&
"video"!=c.nodeName.toLowerCase()){var g=c;c=document.createElement("audio");c[navigator.mozGetUserMedia?"mozSrcObject":"src"]=navigator.mozGetUserMedia?g:window.webkitURL.createObjectURL(g)}d.toggle=d.toggle||[];d.toggle.has=function(a){return-1!==d.toggle.indexOf(a)};c.controls=!1;c.play();var e=document.createElement("div");e.className="media-container";var b=document.createElement("div");b.className="media-controls";e.appendChild(b);var k=document.createElement("div");k.className="control "+(d.toggle.has("mute-audio")?
"unmute-audio selected":"mute-audio");b.appendChild(k);k.style["border-top-left-radius"]="5px";k.onclick=function(){if(-1!=k.className.indexOf("unmute-audio")){if(k.className=k.className.replace("unmute-audio selected","mute-audio"),c.muted=!1,d.onUnMuted)d.onUnMuted("audio")}else if(k.className=k.className.replace("mute-audio","unmute-audio selected"),c.muted=!0,d.onMuted)d.onMuted("audio")};if(!d.buttons||d.buttons&&-1!=d.buttons.indexOf("record-audio")){var f=document.createElement("div");f.className=
"control "+(d.toggle.has("record-audio")?"stop-recording-audio selected":"record-audio");b.appendChild(f);f.onclick=function(){if(-1!=f.className.indexOf("stop-recording-audio")){if(f.className=f.className.replace("stop-recording-audio selected","record-audio"),d.onRecordingStopped)d.onRecordingStopped("audio")}else if(f.className=f.className.replace("record-audio","stop-recording-audio selected"),d.onRecordingStarted)d.onRecordingStarted("audio")}}g=document.createElement("div");g.className="control volume-slider";
g.style.width="auto";b.appendChild(g);var a=document.createElement("input");a.style.marginTop="11px";a.style.width=" 200px";d.buttons&&-1==d.buttons.indexOf("record-audio")&&(a.style.width=" 241px");a.type="range";a.min=0;a.max=100;a.value=100;a.onchange=function(){c.volume="."+a.value.toString().substr(0,1)};g.appendChild(a);var r=document.createElement("div");r.className="control stop";b.appendChild(r);r.onclick=function(){e.style.opacity=0;setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e)},
800);if(d.onStopped)d.onStopped()};r.style["border-top-right-radius"]="5px";r.style["border-bottom-right-radius"]="5px";g=document.createElement("div");g.className="media-box";e.appendChild(g);var m=document.createElement("h2");m.innerHTML=d.title||"Audio Element";m.setAttribute("style","position: absolute;color: rgb(160, 160, 160);font-size: 20px;text-shadow: 1px 1px rgb(255, 255, 255);padding:0;margin:0;");g.appendChild(m);g.appendChild(c);e.style.width="329px";g.style.height="90px";m.style.width=
e.style.width;m.style.height="50px";m.style.overflow="hidden";var p=0;d.showOnMouseEnter||"undefined"===typeof d.showOnMouseEnter?(e.onmouseenter=e.onmousedown=function(){h();b.style.opacity=1},e.onmouseleave=function(){b.style.opacity=0}):setTimeout(function(){h();setTimeout(function(){b.style.opacity=1},300)},700);h();e.toggle=function(a){if("string"!=typeof a)for(var b=0;b<a.length;b++)e.toggle(a[b]);else{if("mute-audio"==a&&k)k.onclick();if("record-audio"==a&&f)f.onclick();if("stop"==a&&r)r.onclick();
return this}};e.media=c;return e}function F(c){var d={},h={},g={};return{receive:function(e){var b=e.uuid;"undefined"!==typeof e.packets&&(g[b]=h[b]=parseInt(e.packets),c.emit("file-start",e));h[b]--;c.emit("file-progress",{uuid:b,maxChunks:g[b],currentPosition:g[b]-h[b]});d[b]||(d[b]=[]);d[b].push(e.message);if(e.last){var k=d[b].join("");L.DataURLToBlob(k,e.fileType,function(f){f.uuid=b;f.name=e.name;f.type=e.fileType;f.extra=e.extra||{};f.url=(window.URL||window.webkitURL).createObjectURL(f);c.autoSaveToDisk&&
E.SaveToDisk(f.url,e.name);c.emit("file-end",f);delete d[b]})}}}}function G(c){var d={};return{receive:function(h){var g=h.uuid;d[g]||(d[g]=[]);d[g].push(h.message);if(h.last){var e=d[g].join("");h.isobject&&(e=JSON.parse(e));c.emit("datachannel-message",e);delete d[g]}}}}window.W5Peer=function(c,d,h){function g(){b.signal({to:"all",userleft:!0})}function e(a,c){a.onended=function(){b.emit("stream-removed",e)};var d=K(a,{buttons:["stop","volume-slider","full-screen","mute-audio","mute-video"],width:innerWidth/
2-20,showOnMouseEnter:!1});d.media.play();-1!=c.indexOf("local")&&(d.media.muted=!0,d.media.volume=0);var e={mediaElement:d,stream:a};b.emit(c,e)}console.log(c);var b=this,k="1hh23bbh3333";b.userid=y();b.userip={};window.extensionID="nlnfogneblaieieknkhaabhhendjdanf";b.events={};b.on=function(a,c){a.indexOf("private");b.events[a]=c};b.emit=function(a,c,d,e,f){if(b.events[a])b.events[a](c,d,e,f);else console.warn("Event ",a," doesn't exists.",c,d,e,f)};b.mediaType={};b.bandwidth={audio:80,video:256};
c.key&&(k=c.key);b.datachannel=!1;b.channels={};b.mediaStreams=[];b.send=function(a){for(var c in b.channels){var d=JSON.stringify(a);b.channels[c].send(d)}};b.sendFile=function(a){M.send(a,b)};b.sendText=function(a){N.send(a,b)};b.direction="two-way";b.peers={};var f;b.openSignalingChannel=function(a){console.log(k);f=io("https://stagew5sig.w5rtc.in/?userid="+b.userid+"&userkey="+k+"&username="+b.username);f.on("connect",function(){if(a&&a.onReady)a.onReady()});f.send=function(a){a.from=b.userid;f.emit("message",
JSON.stringify(a))};f.groupSend=function(a){a.from=b.userid;f.emit("new-group-call",JSON.stringify(a))};f.joinSend=function(a){a.from=b.userid;f.emit("join-group",JSON.stringify(a))};f.on("userIP",function(a){console.log(a);a=JSON.stringify(a);b.userip=JSON.parse(a);console.log(b.userip.userp);for(var c in b.userip.userp)console.log(b.userip.userp[c])});setTimeout(function(){f.emit("userTest","W5RTC")},2E3);f.on("message",function(a){b.emit("signaling-message",JSON.parse(a))});f.on("InvalidUser",
function(a){console.error("Invalid W5CAPI KEY")});f.on("keyExpired",function(a){console.error("Your W5CAPI KEY WAS Expired")});f.on("user-left",function(a){b.emit("user-left-private",a)})};b.signal=function(a){f.send(a)};b.on("signaling-message",function(a){if(a.isCustomMessage)return b.emit("custom-signaling-message",a);a.from==b.userid||a.to&&a.to!=b.userid||(a.closePeer&&b.emit("user-left-private",a.from),a.sdp&&b.peers[a.peerid]&&("offer"==a.sdp.type?b.emit("offer-sdp",a):b.emit("answer-sdp",
a)),a.candidate&&b.peers[a.peerid]&&(l("received candidate",a.candidate.candidate),b.peers[a.peerid].emit("candidate",a.candidate)),a.areYouReady&&(b.peers[a.peerid]=new z(b,a.peerid),b.emit("are-you-ready",a)),a.ready&&b.emit("user-ready",a),a.userleft&&b.emit("user-left-private",a.from),a.cutCall&&b.emit("cutCall",a.from))});b.AllowedCandidates={Host:!0,TURN:!0,STUN:!0};b.resolutions={minWidth:320,minHeight:180,maxWidth:1280,maxHeight:720,minFrameRate:10,minAspectRatio:1.33};b.setResolutions=function(a,
c){b.resolutions.maxWidth=a;b.resolutions.maxHeight=c};b.on("user-ready",function(a){l("user whose id is ",a.from,", is ready.");b.datachannel&&w(b.mediaType)?(b.peers[a.peerid].createOffer().sendTo(a.from),console.log("its goes to datachannel")):b.peers[a.peerid].getLocalStream(function(){b.peers[a.peerid].createOffer().sendTo(a.from)})});b.on("are-you-ready",function(a){l(a.from," asked that are you ready?");b.mediaType=a.mediaType;sessionStorage.targetUser=a.from;"one-way"==a.direction&&b.signal({to:a.from,
peerid:a.peerid,ready:!0});"two-way"==a.direction&&(b.datachannel&&w(b.mediaType)?b.signal({to:a.from,peerid:a.peerid,ready:!0}):b.peers[a.peerid].getLocalStream(function(){b.signal({to:a.from,peerid:a.peerid,ready:!0})}))});b.on("offer-sdp",function(a){l("got",a.sdp.type);b.peers[a.peerid].setRemoteDescription(a.sdp).createAnswer().sendTo(a.from)});b.on("answer-sdp",function(a){l("got",a.sdp.type);b.peers[a.peerid].setRemoteDescription(a.sdp)});b.on("cutCall",function(a){b.emit("cutCall".message)});
b.stopStream=function(){window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]};try{window.localStream.stop()}catch(a){console.warn("localStream not running now")}b.mediaStreams=[]};b.muteAudio=function(){try{window.localStream.getAudioTracks()[0].enabled=!1}catch(a){console.log("LocalStream not running now")}};b.unmuteAudio=function(){try{window.localStream.getAudioTracks()[0].enabled=!0}catch(a){console.log("LocalStream not running now")}};b.stopCall=function(){b.mediaStreams=[];window.currentUserMediaRequest=
{streams:[],mutex:!1,queueRequests:[]};try{for(var a in b.peers){var c=b.peers[a].peer.connection;if(c.getRemoteStreams()[0]){try{c.getRemoteStreams()[0].stop()}catch(d){}window.localStream.stop();b.signal({to:b.peers[a].targetUser,cutCall:!0})}}}catch(e){console.warn("Reomte Stream Not Running"),console.log(e)}};b.pauseVideo=function(){try{window.localStream.getVideoTracks()[0].enabled=!1}catch(a){console.log("LocalStream not running now")}};b.playVideo=function(){try{window.localStream.getVideoTracks()[0].enabled=
!0}catch(a){console.log("LocalStream not running now")}};b.closePeer=function(){window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]};for(var a in b.channels)b.channels[a]&&(b.channels[a].close(),delete b.channels[a]);try{window.localStream.stop()}catch(c){console.warn("localStream not running now")}v&&setTimeout(function(){b.emit("datachannel-close","event")},200);for(var d in b.peers)try{if(b.peers[d].targetUser){var e=b.peers[d].targetUser;"closed"!==b.peers[d].peer.connection.signalingState&&
-1===b.peers[d].peer.connection.iceConnectionState.search(/disconnected|failed/gi)&&(b.peers[d].peer.connection.close(),delete b.peers[d]);e&&(b.emit("user-left-private",e),b.signal({to:e,peerid:d,closePeer:!0}))}}catch(f){}};b.call=function(a){var c=y();b.peers[c]=new z(b,c,a);b.direction=b.direction;sessionStorage.targetUser=a;b.signal({to:a,peerid:c,direction:b.direction,mediaType:b.mediaType,areYouReady:!0})};b.saveToDisk=function(a,b){E.SaveToDisk(a,b)};b.sendCustomMessage=function(a){a.userid=
b.userid;a.isCustomMessage=!0;f.send(a)};b.createGroup=function(a){a.userid=b.userid;a.isCustomMessage=!0;f.groupSend(a)};b.joinGroup=function(a){a.userid=b.userid;a.isCustomMessage=!0;f.joinSend(a)};b.on("user-left-private",function(a){var c=!1,d;for(d in b.peers)if(b.peers[d].targetUser==a&&(c=!0,"closed"!==b.peers[d].peer.connection.signalingState&&-1===b.peers[d].peer.connection.iceConnectionState.search(/disconnected|failed/gi)&&b.peers[d].peer.connection.close(),delete b.peers[d]),c)for(var e in b.channels)e==
a&&(delete b.channels[e],c=!0);b.emit("user-left",a)});b.on("remote-stream-private",function(a){e(a,"remote-stream")});b.on("local-stream-private",function(a){e(a,"local-stream")});b.on("stream-removed",function(a){a.mediaElement&&a.mediaElement.parentNode&&a.mediaElement.parentNode.removeChild(a.mediaElement)});window.addEventListener("beforeunload",function(){g()},!1);window.addEventListener("keydown",function(a){116==a.keyCode&&g()},!1)};window.MediaStream=window.MediaStream||window.webkitMediaStream;
window.AudioContext=window.AudioContext||window.webkitAudioContext;var H=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,I=window.mozRTCSessionDescription||window.RTCSessionDescription,J=window.mozRTCIceCandidate||window.RTCIceCandidate,t=!!navigator.webkitGetUserMedia,v=!!navigator.mozGetUserMedia,C=navigator.mozGetUserMedia?0:parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2]);navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);var A={mandatory:{},
optional:[]};window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]};var M={send:function(c,d){function h(){var a=URL.createObjectURL(new Blob(["function readFile(_file) {postMessage(new FileReaderSync().readAsDataURL(_file));};this.onmessage =  function (e) {readFile(e.data);}"],{type:"application/javascript"})),b=new Worker(a);URL.revokeObjectURL(a);return b}function g(a,h){var l={type:"file",uuid:c.uuid,maxChunks:k,currentPosition:k-f,name:c.name,fileType:c.type,size:c.size};a&&(h=
a,k=f=l.packets=parseInt(h.length/e),c.maxChunks=l.maxChunks=k,l.currentPosition=k-f,d.emit("file-start",c));f--;d.emit("file-progress",{uuid:c.uuid,maxChunks:k,currentPosition:k-f});h.length>e?l.message=h.slice(0,e):(l.message=h,l.last=!0,l.name=c.name,c.url=URL.createObjectURL(c),d.emit("file-end",c));d.send(l);b=h.slice(l.message.length);b.length&&setTimeout(function(){g(null,b)},d.chunkInterval||500)}var e=15E3;d.chunkSize&&(e=d.chunkSize);var b="",k=0,f=0;c.uuid=y();if(window.Worker){var a=h();
a.onmessage=function(a){g(a.data)};a.postMessage(c)}else a=new FileReader,a.onload=function(a){g(a.target.result)},a.readAsDataURL(c)}},E={SaveToDisk:function(c,d){var h=document.createElement("a");h.href=c;h.target="_blank";h.download=d||c;var g=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});h.dispatchEvent(g);(window.URL||window.webkitURL).revokeObjectURL(h.href)}},N={send:function(c,d){function h(c,f){var a={type:"text",uuid:b};c&&(f=c,a.packets=parseInt(f.length/1E3));1E3<f.length?
a.message=f.slice(0,1E3):(a.message=f,a.last=!0,a.isobject=e);d.send(a);g=f.slice(a.message.length);g.length&&(config.preferSCTP||v?setTimeout(function(){h(null,g)},100):setTimeout(function(){h(null,g)},500))}var g="",e=!1;"string"!==typeof c&&(e=!0,c=JSON.stringify(c));var b=y();h(c)}},L={DataURLToBlob:function(c,d,h){function g(){var b=URL.createObjectURL(new Blob(['function getBlob(_dataURL, _fileType) {var binary = atob(_dataURL.substr(_dataURL.indexOf(",") + 1)),i = binary.length,view = new Uint8Array(i);while (i--) {view[i] = binary.charCodeAt(i);};postMessage(new Blob([view], {type: _fileType}));};this.onmessage =  function (e) {var data = JSON.parse(e.data); getBlob(data.dataURL, data.fileType);}'],
{type:"application/javascript"})),c=new Worker(b);URL.revokeObjectURL(b);return c}if(window.Worker){var e=g();e.onmessage=function(b){h(b.data)};e.postMessage(JSON.stringify({dataURL:c,fileType:d}))}else{c=atob(c.substr(c.indexOf(",")+1));d=c.length;for(e=new Uint8Array(d);d--;)e[d]=c.charCodeAt(d);h(new Blob([e]))}}}})();
